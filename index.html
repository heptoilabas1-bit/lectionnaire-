<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lectionnaire Interlin√©aire Orthodoxe</title>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>

    <header>
        <h1 id="app-title">‚úù Lectionnaire Interlin√©aire Orthodoxe</h1>
        <div id="controls">
            <label for="sunday-select">Choisir le Dimanche :</label>
            <select id="sunday-select"></select>
        </div>
    </header>

    <main>
        
        <div id="main-content">
            
            <div id="panel-toggles" class="text-tools">
                <button id="toggle-greek" class="tool-btn">Grec Int√©gral</button>
                <button id="toggle-french" class="tool-btn">Fran√ßais Int√©gral</button>
                
                <a id="pdf-button-container" href="#" target="_blank" class="pdf-btn" style="display: none;">
                    üìÑ Voir le PDF
                </a>
            </div>
            
            <div id="text-selector">
                <button id="select-gospel" class="active">√âvangile</button>
                <button id="select-apostle">Ap√¥tre</button>
            </div>

            <h2 id="verse-title">Chargement...</h2>
            
            <div id="gospel-text" class="interlinear-container">
                </div>
            
            <section id="notes-view" class="analysis-panel">
                <h3>Notes / Analyse (**P.Pascal**)</h3>
                <p id="my-notes">Chargement de l'analyse...</p>

             <h4>Contributions Communautaires</h4>
<div id="form-container" style="background-color: #f4f4f4; padding: 15px; border-radius: 5px; margin-top: 10px;">
  <p style="font-size: 0.9em; margin-bottom: 10px;">Envoyez une analyse au P√®re Pascal ou au webmaster :</p>
  
  <form action="https://formspree.io/f/xaqqqanj" method="POST">
    
    <label for="nom" style="display:block; margin-top:10px;">Votre Nom :</label>
    <input type="text" name="nom" required style="width: 100%; padding: 8px; box-sizing: border-box;">

    <label for="email" style="display:block; margin-top:10px;">Votre Email (pour r√©ponse) :</label>
    <input type="email" name="email" required style="width: 100%; padding: 8px; box-sizing: border-box;">

    <label for="reference" style="display:block; margin-top:10px;">Passage biblique :</label>
    <input type="text" name="reference" placeholder="Ex: Luc 15 (Fils Prodigue)" style="width: 100%; padding: 8px; box-sizing: border-box;">

    <label for="message" style="display:block; margin-top:10px;">Votre Contribution :</label>
    <textarea name="message" rows="4" required style="width: 100%; padding: 8px; box-sizing: border-box;"></textarea>

    <button type="submit" style="margin-top: 15px; background-color: #28a745; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; width: 100%;">
      Envoyer par mail
    </button>
  </form>
</div>   
            </section>
        </div>


        <div id="side-panels">
            <section id="greek-view" class="side-panel hidden">
                <button class="close-btn">X</button> 
                <h3>Texte Grec Int√©gral</h3>
                <pre id="greek-full-text"></pre>
            </section>
            <section id="french-view" class="side-panel hidden">
                <button class="close-btn">X</button>
                <h3>Traduction Fran√ßaise (Int√©grale)</h3>
                <pre id="french-full-text"></pre>
            </section>
        </div>
        
    </main>
    
    <footer id="footer-info">
        <p>Inspiration du projet : **P√®re Pascal**</p>
    </footer>

    <script src="app.js"></script>
<div id="bulle-info"></div>

<script>
    // ============================================================
    // 1. GESTION DES INFO-BULLES (Le Clic)
    // ============================================================
    document.addEventListener('click', function(e) {
        var bulle = document.getElementById('bulle-info');

        // Si on clique sur un mot interactif
        if (e.target.classList.contains('mot-info')) {
            e.preventDefault();
            var contenu = e.target.getAttribute('data-analyse');
            if (contenu) {
                bulle.innerHTML = contenu;
                bulle.style.display = 'block';
            }
        }
        // Si on clique ailleurs, on ferme
        else if (bulle && e.target.id !== 'bulle-info') {
            bulle.style.display = 'none';
        }
    });

    // ============================================================
    // 2. GESTION DU LECTIONNAIRE (Chargement & Num√©rotation)
    // ============================================================

    // Fonction pour trouver le premier num√©ro de verset dans la r√©f√©rence
    // Ex: "Luc 18, 10-14" -> renvoie 10
    function getStartVerse(reference) {
        if (!reference) return 1;
        // Cherche un chiffre apr√®s une virgule ou deux-points (ex: "18,10" ou "18:10")
        var match = reference.match(/[,:]\s*(\d+)/);
        if (match && match[1]) {
            return parseInt(match[1], 10);
        }
        return 1; // S√©curit√© si on ne trouve pas
    }

  // Fonction d'affichage BLIND√âE
    function displaySection(data, containerId, titleId, refId, notesId) {
        if (!data) return;

        // 1. Remplir les textes
        document.getElementById(titleId).textContent = data.title;
        document.getElementById(refId).textContent = data.reference;
        document.getElementById(notesId).innerHTML = data.personal_analysis || "Pas d'analyse disponible.";

        // 2. Injecter le HTML de l'interlin√©aire
        var container = document.getElementById(containerId);
        container.innerHTML = data.interlinear;

        // 3. --- NUM√âROTATION (Version "Force Brute") ---
        var startNum = getStartVerse(data.reference);
        
        // Au lieu de chercher une classe pr√©cise, on prend TOUS les enfants directs (les blocs de versets)
        var verses = container.children; 
        
        for (var i = 0; i < verses.length; i++) {
            // A. On force l'ajout de la classe pour que le CSS fonctionne
            verses[i].classList.add('interlinear-verse');
            
            // B. On ajoute le num√©ro
            verses[i].setAttribute('data-num', startNum + i);
        }
    }  

    // Chargement du fichier JSON
    async function loadSunday(fileName) {
        document.getElementById('gospel-interlinear').innerHTML = '<p style="text-align:center; color:#999;">Chargement...</p>';
        
        try {
            const response = await fetch('data/' + fileName);
            if (!response.ok) throw new Error("Fichier non trouv√©");
            
            const data = await response.json();

            // Afficher √âvangile
            displaySection(data.gospel, 'gospel-interlinear', 'gospel-title', 'gospel-ref', 'gospel-notes');
            
            // Afficher Ap√¥tre
            displaySection(data.apostle, 'apostle-interlinear', 'apostle-title', 'apostle-ref', 'apostle-notes');

            // Mettre √† jour les Modales
            var greekModal = document.getElementById('modal-greek-content');
            if(greekModal) greekModal.innerText = data.gospel.greek_only;
            
            var frenchModal = document.getElementById('modal-french-content');
            if(frenchModal) frenchModal.innerText = data.gospel.french_only;

        } catch (error) {
            console.error(error);
            document.getElementById('gospel-title').textContent = "Erreur";
        }
    }

    // D√©marrage : charger le premier fichier de la liste
    // (V√©rifiez bien que ce nom de fichier existe dans votre dossier data !)
    loadSunday('triode_1_publican.json'); 

    // Changement via le menu
    document.getElementById('sunday-select').addEventListener('change', function() {
        loadSunday(this.value);
    });
</script>

</body>

</html>





