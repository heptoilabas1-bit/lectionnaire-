<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lectionnaire Interlin√©aire Orthodoxe</title>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>

    <header>
        <h1 id="app-title">‚úù Lectionnaire Interlin√©aire Orthodoxe</h1>
        <div id="controls">
            <label for="sunday-select">Choisir le Dimanche :</label>
            <select id="sunday-select"></select>
        </div>
    </header>

    <main>
        
        <div id="main-content">
            
            <div id="panel-toggles" class="text-tools">
                <button id="toggle-greek" class="tool-btn">Grec Int√©gral</button>
                <button id="toggle-french" class="tool-btn">Fran√ßais Int√©gral</button>
                
                <a id="pdf-button-container" href="#" target="_blank" class="pdf-btn" style="display: none;">
                    üìÑ Voir le PDF
                </a>
            </div>
            
            <div id="text-selector">
                <button id="select-gospel" class="active">√âvangile</button>
                <button id="select-apostle">Ap√¥tre</button>
            </div>

            <h2 id="verse-title">Chargement...</h2>
            
            <div id="gospel-text" class="interlinear-container">
                </div>
            
            <section id="notes-view" class="analysis-panel">
                <h3>Notes / Analyse (**P.Pascal**)</h3>
                <p id="my-notes">Chargement de l'analyse...</p>

             <h4>Contributions Communautaires</h4>
<div id="form-container" style="background-color: #f4f4f4; padding: 15px; border-radius: 5px; margin-top: 10px;">
  <p style="font-size: 0.9em; margin-bottom: 10px;">Envoyez une analyse au P√®re Pascal ou au webmaster :</p>
  
  <form action="https://formspree.io/f/xaqqqanj" method="POST">
    
    <label for="nom" style="display:block; margin-top:10px;">Votre Nom :</label>
    <input type="text" name="nom" required style="width: 100%; padding: 8px; box-sizing: border-box;">

    <label for="email" style="display:block; margin-top:10px;">Votre Email (pour r√©ponse) :</label>
    <input type="email" name="email" required style="width: 100%; padding: 8px; box-sizing: border-box;">

    <label for="reference" style="display:block; margin-top:10px;">Passage biblique :</label>
    <input type="text" name="reference" placeholder="Ex: Luc 15 (Fils Prodigue)" style="width: 100%; padding: 8px; box-sizing: border-box;">

    <label for="message" style="display:block; margin-top:10px;">Votre Contribution :</label>
    <textarea name="message" rows="4" required style="width: 100%; padding: 8px; box-sizing: border-box;"></textarea>

    <button type="submit" style="margin-top: 15px; background-color: #28a745; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; width: 100%;">
      Envoyer par mail
    </button>
  </form>
</div>   
            </section>
        </div>


        <div id="side-panels">
            <section id="greek-view" class="side-panel hidden">
                <button class="close-btn">X</button> 
                <h3>Texte Grec Int√©gral</h3>
                <pre id="greek-full-text"></pre>
            </section>
            <section id="french-view" class="side-panel hidden">
                <button class="close-btn">X</button>
                <h3>Traduction Fran√ßaise (Int√©grale)</h3>
                <pre id="french-full-text"></pre>
            </section>
        </div>
        
    </main>
    
    <footer id="footer-info">
        <p>Inspiration du projet : **P√®re Pascal**</p>
    </footer>

    <script src="app.js"></script>
<div id="bulle-info"></div>

<script>
    // --- 1. GESTION DES BULLES (CLIC) ---
    document.addEventListener('click', function(e) {
        var bulle = document.getElementById('bulle-info');
        if (e.target.classList.contains('mot-info')) {
            e.preventDefault();
            var contenu = e.target.getAttribute('data-analyse');
            if (contenu && bulle) {
                bulle.innerHTML = contenu;
                bulle.style.display = 'block';
            }
        } else if (bulle && e.target.id !== 'bulle-info') {
            bulle.style.display = 'none';
        }
    });

    // --- 2. OUTIL : Trouver le num√©ro du verset ---
    function getStartVerse(reference) {
        if (!reference) return 1;
        var match = reference.match(/[,:]\s*(\d+)/);
        if (match && match[1]) {
            return parseInt(match[1], 10);
        }
        return 1;
    }

    // --- 3. FONCTION D'AFFICHAGE S√âCURIS√âE ---
    function displaySection(data, containerId, titleId, refId, notesId) {
        if (!data) return;

        // 1. Textes de base (Titre, R√©f√©rence...)
        var t = document.getElementById(titleId); if(t) t.textContent = data.title;
        var r = document.getElementById(refId); if(r) r.textContent = data.reference;
        var n = document.getElementById(notesId); if(n) n.innerHTML = data.personal_analysis || "";

        // 2. Injection du HTML
        var container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = data.interlinear;

        // 3. NUM√âROTATION INTELLIGENTE
        // On r√©cup√®re le chiffre de d√©part (ex: 11)
        var startNum = getStartVerse(data.reference); 
        
        // On r√©cup√®re tous les blocs de versets (les manuels ET les anciens)
        // D'abord on cherche la classe officielle, sinon les paragraphes <p>
        var verses = container.querySelectorAll('.interlinear-verse');
        if (verses.length === 0) verses = container.querySelectorAll('p');

        for (var i = 0; i < verses.length; i++) {
            var v = verses[i];
            var numeroCalcule = startNum + i; // Le num√©ro qu'on devrait avoir (11, 12... 21...)

            // V√âRIFICATION : Le verset commence-t-il D√âJ√Ä par un chiffre ?
            // On regarde le texte brut pour voir s'il y a d√©j√† "11." ou "12."
            var textClean = v.innerText.trim();
            // Cette formule magique v√©rifie si √ßa commence par un nombre
            var aDejaUnNumero = /^\d+/.test(textClean);

            // Si PAS de chiffre au d√©but (donc c'est un ancien verset), on l'ajoute !
            if (!aDejaUnNumero) {
                var spanNum = document.createElement("strong");
                
                // Style Orange
                spanNum.style.color = "#e67e22"; 
                spanNum.style.marginRight = "5px";
                spanNum.innerText = numeroCalcule + ". ";
                
                // On ins√®re au tout d√©but du bloc
                v.insertBefore(spanNum, v.firstChild);
            }
        }
    }
    

    // --- 4. CHARGEMENT ---
    async function loadSunday(fileName) {
        // Petit message de chargement si la boite existe
        var loader = document.getElementById('gospel-interlinear');
        if (loader) loader.innerHTML = '<p style="text-align:center; color:#999;">Chargement...</p>';
        
        try {
            const response = await fetch('data/' + fileName);
            if (!response.ok) throw new Error("Fichier introuvable : " + fileName);
            
            const data = await response.json();

            // Affichage √âvangile
            if (data.gospel) {
                displaySection(data.gospel, 'gospel-interlinear', 'gospel-title', 'gospel-ref', 'gospel-notes');
            }

            // Affichage Ap√¥tre (Souvent c'est ici que √ßa plante si l'Ap√¥tre manque dans le HTML)
            if (data.apostle) {
                displaySection(data.apostle, 'apostle-interlinear', 'apostle-title', 'apostle-ref', 'apostle-notes');
            }
            
            // Modales (Grec/Fran√ßais) - avec v√©rification
            var greekModal = document.getElementById('modal-greek-content');
            if(greekModal && data.gospel) greekModal.innerText = data.gospel.greek_only;
            
            var frenchModal = document.getElementById('modal-french-content');
            if(frenchModal && data.gospel) frenchModal.innerText = data.gospel.french_only;

        } catch (error) {
            console.error("Erreur de chargement :", error);
        }
    }

    // D√©marrage
    loadSunday('triode_1_publican.json'); 

    // Menu d√©roulant
    var selectMenu = document.getElementById('sunday-select');
    if (selectMenu) {
        selectMenu.addEventListener('change', function() {
            loadSunday(this.value);
        });
    }
</script>

</body>

</html>










